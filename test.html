<!DOCTYPE html>
<html>
<head>
    <title>Audio Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        button { padding: 10px; margin: 10px; background: #4f46e5; color: white; border: none; cursor: pointer; }
        .success { color: green; }
        .error { color: red; }
        #log { margin-top: 20px; border: 1px solid #ccc; padding: 10px; height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>AIKIRA Audio Test Tool</h1>
    <div>
        <button onclick="testAudio('jump')">Test jump.mp3</button>
        <button onclick="testAudio('collect')">Test collect.mp3</button>
        <button onclick="testAudio('hit')">Test hit.mp3</button>
        <button onclick="testAudio('gameover')">Test gameover.mp3</button>
    </div>
    <div>
        <button onclick="testAllAudio()">Test All Sounds</button>
        <button onclick="testWithHTML5Audio()">Test with HTML5 Audio</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>
    <div id="log"></div>

    <script>
        // Log function
        function log(message, isError = false) {
            const logElement = document.getElementById('log');
            const entry = document.createElement('div');
            entry.textContent = message;
            entry.className = isError ? 'error' : 'success';
            logElement.appendChild(entry);
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        // Test a single audio file with Web Audio API
        function testAudio(name) {
            log(`Testing ${name}.mp3 with Web Audio API...`);
            
            // Create context on demand (needed for some browsers)
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // Log audio context state
            log(`Audio context state: ${audioContext.state}`);
            
            // Resume context if suspended
            if (audioContext.state === 'suspended') {
                audioContext.resume().then(() => {
                    log('Audio context resumed');
                }).catch(err => {
                    log(`Error resuming context: ${err}`, true);
                });
            }
            
            // Load the audio file
            fetch(`/assets/audio/${name}.mp3`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.arrayBuffer();
                })
                .then(arrayBuffer => {
                    log(`File ${name}.mp3 loaded successfully (${arrayBuffer.byteLength} bytes)`);
                    
                    // Decode the audio
                    return audioContext.decodeAudioData(arrayBuffer);
                })
                .then(audioBuffer => {
                    log(`${name}.mp3 decoded successfully (${audioBuffer.duration.toFixed(2)} seconds)`);
                    
                    // Create source
                    const source = audioContext.createBufferSource();
                    source.buffer = audioBuffer;
                    
                    // Connect to output
                    source.connect(audioContext.destination);
                    
                    // Play sound
                    source.start(0);
                    log(`${name}.mp3 is now playing!`);
                    
                    // Handle when playback ends
                    source.onended = () => {
                        log(`${name}.mp3 playback complete`);
                    };
                })
                .catch(error => {
                    log(`Error with ${name}.mp3: ${error.message}`, true);
                });
        }
        
        // Test all audio files sequentially
        function testAllAudio() {
            const sounds = ['jump', 'collect', 'hit', 'gameover'];
            let index = 0;
            
            function playNext() {
                if (index < sounds.length) {
                    const sound = sounds[index++];
                    testAudio(sound);
                    setTimeout(playNext, 1500);
                }
            }
            
            playNext();
        }
        
        // Test with simpler HTML5 Audio
        function testWithHTML5Audio() {
            const sounds = ['jump', 'collect', 'hit', 'gameover'];
            
            sounds.forEach(sound => {
                log(`Testing ${sound}.mp3 with HTML5 Audio...`);
                const audio = new Audio(`/assets/audio/${sound}.mp3`);
                
                audio.oncanplaythrough = () => {
                    log(`${sound}.mp3 loaded and can play`);
                };
                
                audio.onplay = () => {
                    log(`${sound}.mp3 started playing`);
                };
                
                audio.onended = () => {
                    log(`${sound}.mp3 finished playing`);
                };
                
                audio.onerror = (e) => {
                    log(`Error loading ${sound}.mp3: ${audio.error.code}`, true);
                };
                
                // Attempt to play
                const playPromise = audio.play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        log(`Failed to play ${sound}.mp3: ${error}`, true);
                    });
                }
            });
        }
    </script>
</body>
</html>